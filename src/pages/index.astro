---
import Header from '../components/Header.astro'
import Link from '../components/Link.astro'
import SearchBar from '../components/SearchBar.astro'
import MainLayout from '../layouts/MainLayout.astro'
import { getCollection } from 'astro:content'

// Fetch all the blog posts
const blogPosts = await getCollection('blog', ({ data }) => {
  return data
})

// Pass the fetched data to the data attribute of the section that will show the links
function sendPosts(collection) {
  return JSON.stringify(collection)
}
---

<MainLayout title="Fuzzy Search">
  <!-- Fuzzy Search -->

  <Header />
  <main class="flex flex-col overflow-y-scroll">
    <!-- The section that will show the links to the pages -->
    <section
      id="results"
      class="px-8 py-8 flex flex-col h-full gap-8">
      <!-- Looping through the filtered posts and only show the links that match the query -->
      <div id="results">
        <template x-for="link in filteredPosts">
          <a
            :href="link.data.url"
            class="flex flex-col gap-4 border-2 rounded-lg p-6">
            <h1
              class="font-bold text-2xl"
              x-text="link.data.meta.title">
            </h1>
            <p x-text="link.data.excerpt"></p>
          </a>
        </template>
      </div>
    </section>
  </main>
  <!-- SearchBar component -->
  <SearchBar />
</MainLayout>
